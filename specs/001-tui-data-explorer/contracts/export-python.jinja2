#!/usr/bin/env python3
"""
{{ analysis_name }}

{{ analysis_description }}

Generated: {{ generated_at }}
Source Dataset: {{ dataset_path }}
Operations: {{ operation_count }}
Generated by: kittiwake {{ kittiwake_version }}
"""

import narwhals as nw


def main():
    # Load dataset
    print("Loading dataset from: {{ dataset_path }}")
{% if dataset_path.endswith('.csv') %}
    df = nw.scan_csv(r"{{ dataset_path }}")
{% elif dataset_path.endswith('.parquet') %}
    df = nw.scan_parquet(r"{{ dataset_path }}")
{% elif dataset_path.endswith('.json') %}
    df = nw.scan_json(r"{{ dataset_path }}")
{% else %}
    df = nw.from_native(nw.read_csv(r"{{ dataset_path }}"))
{% endif %}
    print(f"Original shape: {df.collect().shape}")
    
{% for operation in operations %}
    # Operation {{ loop.index }}: {{ operation.display }}
    print("Applying: {{ operation.display }}")
    {{ operation.code }}
    
{% endfor %}
    # Materialize final result
    print("\nFinal results:")
    result = df.collect()
    print(f"Shape: {result.shape}")
    print(f"Columns: {result.columns}")
    print("\nFirst 10 rows:")
    print(result.head(10))
    
    # Optional: Save to file
    # result.write_csv("output.csv")
    # result.write_parquet("output.parquet")
    
    return result


if __name__ == "__main__":
    result = main()
